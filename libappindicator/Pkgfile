# Description: Allow applications to extend a menu via Ayatana indicators in Unity, KDE or Systray
# URL: https://launchpad.net/libappindicator
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: libindicator gtk-sharp

name=libappindicator
version=12.10.0
release=1
source=(http://launchpad.net/libappindicator/${version%.*}/$version/+download/libappindicator-$version.tar.gz incompatible_pointer_build_fix.patch no-python.patch improved-plasma.patch)

build() {
  cd libappindicator-$version
  sed 's|/cli/|/mono/|' -i bindings/mono/{appindicator-sharp-0.1.pc.in,Makefile.in}
  sed 's/example //g' -i Makefile.in
  sed -i -e 's/ -Werror//' {src,tests}/Makefile.{am,in}
  patch -p1 < "$SRC/improved-plasma.patch"
  patch -p1 -i ../incompatible_pointer_build_fix.patch
  patch -p1 < $SRC/no-python.patch
  cd ..
  mkdir -p build{-gtk2,-gtk3}
  export CFLAGS="${CFLAGS} -Wno-deprecated-declarations"
  export CSC='/usr/bin/mcs'
  cd build-gtk3
  ../$name-$version/configure --prefix=/usr \
      --localstatedir=/var \
      --disable-{gtk-doc-html,mono-test,static,tests} \
      --with-gtk=3
  make
  make DESTDIR=$PKG -j1 install
  cd ../build-gtk2
  #cd build-gtk2
  ../$name-$version/configure --prefix=/usr \
      --localstatedir=/var \
      --disable-{gtk-doc-html,mono-test,static,tests} \
      --with-gtk=2
  make -j1
  make DESTDIR=$PKG -j1 install
  #make -j1 -C bindings/mono DESTDIR=$PKG install
  rm -r $PKG/usr/share/gtk-doc
}
