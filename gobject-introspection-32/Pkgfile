# Description: A middleware layer between C libraries (using GObject) and language bindings.
# URL: https://live.gnome.org/GObjectIntrospection
# Maintainer: Danny Rawlins, crux at romster dot me
# Packager: Matt Housh, jaeger at morpheus dot net
# Depends on: glib

name=gobject-introspection
version=1.58.3
release=1
source=(https://ftp.gnome.org/pub/GNOME/sources/${name:0:21}/${version::4}/$name-$version.tar.xz)

build() {
  cd ${name:0:21}-$version
  export CC='gcc -m32'
  export CXX='g++ -m32'
  export PKG_CONFIG_PATH='/usr/lib32/pkgconfig'
  PYTHON=/usr/bin/python meson . build \
    --prefix=/usr \
    --libdir=/usr/lib32 \
    -Dcairo=true \
    -Dgtk-doc=false
  ninja -C build
  DESTDIR=$PKG ninja -C build install
	#rm -rf $PKG/usr/share/gtk-doc
  python3 -m compileall -d /usr/lib/gobject-introspection $PKG/usr/lib/gobject-introspection
  python3 -O -m compileall -d /usr/lib/gobject-introspection $PKG/usr/lib/gobject-introspection
}
