# Description: An image loading library for GTK+
# URL: https://www.gtk.org/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: gdk-pixbuf glib-32 libpng-32 libtiff-32 xorg-libx11-32

name=gdk-pixbuf-32
version=2.38.1
release=1
source=(https://download.gnome.org/sources/${name%-*}/${version%.*}/${name%-*}-$version.tar.xz)

build() {
  cd ${name%-*}-$version

  export CC="gcc -m32"
  export CXX="g++ -m32"
  export PKG_CONFIG_PATH+=":/usr/lib32/pkgconfig"
  export CFLAGS="-I/usr/include/libtiff32 $CFLAGS"

  meson build \
    --prefix=/usr \
    --libdir=/usr/lib32 \
    -D installed_tests=false \
    -D gir=false \
    -D gio_sniffing=false \
    -D man=false
  ninja -C build
  DESTDIR=$PKG meson install -C build
  mv $PKG/usr/bin/gdk-pixbuf-query-loaders \
    $PKG/usr/bin/gdk-pixbuf-query-loaders-32

  mv $PKG/usr/bin/gdk-pixbuf-thumbnailer \
    $PKG/usr/bin/gdk-pixbuf-thumbnailer-32

  rm $PKG/usr/bin/{gdk-pixbuf-pixdata,gdk-pixbuf-csource}
  rm -r $PKG/usr/include
  rm -r $PKG/usr/share/{thumbnailers/gdk-pixbuf-thumbnailer.thumbnailer,thumbnailers,locale}
}
