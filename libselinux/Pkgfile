# Description: SELinux library and simple utilities
# URL: http://userspace.selinuxproject.org
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: libsepol python python3 ruby swig

name=libselinux
version=2.9
release=1
source=(https://github.com/SELinuxProject/selinux/releases/download/20190315/$name-$version.tar.gz)

build() {
	cd $name-$version

	# Do not build deprecated rpm_execcon() interface.
	export DISABLE_RPM=y

	make swigify
	make all
	make PYTHON=/usr/bin/python2 pywrap
	make PYTHON=/usr/bin/python3 pywrap
	make RUBY=/usr/bin/ruby rubywrap

	make DESTDIR=$PKG SBINDIR=/usr/bin SHLIBDIR=/usr/lib install
	make DESTDIR=$PKG PYTHON=/usr/bin/python2 SBINDIR=/usr/bin SHLIBDIR=/usr/lib install-pywrap
	make DESTDIR=$PKG PYTHON=/usr/bin/python3 SBINDIR=/usr/bin SHLIBDIR=/usr/lib install-pywrap
	make DESTDIR=$PKG RUBY=/usr/bin/ruby SBINDIR=/usr/bin SHLIBDIR=/usr/lib install-rubywrap
	/usr/bin/python2 -m compileall "${pkgdir}/$(/usr/bin/python2 -c 'from distutils.sysconfig import *; print(get_python_lib(plat_specific=1))')"
	/usr/bin/python3 -m compileall "${pkgdir}/$(/usr/bin/python3 -c 'from distutils.sysconfig import *; print(get_python_lib(plat_specific=1))')"
}
